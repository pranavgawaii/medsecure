{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/8teen/Downloads/Devlopment/GitHub%20Repository/medsecurree/app/api/init-db/route.ts"],"sourcesContent":["import { neon } from \"@neondatabase/serverless\"\nimport { NextResponse } from \"next/server\"\n\nexport async function POST() {\n  try {\n    const databaseUrl = process.env.NEON_POSTGRES_URL || process.env.NEON_NEON_DATABASE_URL\n    if (!databaseUrl) {\n      return NextResponse.json({ error: \"Database URL not configured\" }, { status: 500 })\n    }\n\n    const sql = neon(databaseUrl)\n\n    await sql`\n      CREATE TABLE IF NOT EXISTS patients (\n        id SERIAL PRIMARY KEY,\n        patient_id VARCHAR(50) UNIQUE NOT NULL,\n        name VARCHAR(255) NOT NULL,\n        age INT,\n        gender VARCHAR(10),\n        medical_conditions VARCHAR(500),\n        emergency_contact VARCHAR(255),\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `\n\n    await sql`\n      CREATE TABLE IF NOT EXISTS ambulances (\n        id SERIAL PRIMARY KEY,\n        ambulance_id VARCHAR(50) UNIQUE NOT NULL,\n        driver_name VARCHAR(255),\n        status VARCHAR(50) DEFAULT 'available',\n        current_patient_id VARCHAR(50),\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n      )\n    `\n\n    await sql`\n      CREATE TABLE IF NOT EXISTS vitals (\n        id SERIAL PRIMARY KEY,\n        patient_id VARCHAR(50) NOT NULL,\n        ambulance_id VARCHAR(50),\n        heart_rate INT,\n        spo2 DECIMAL(5, 2),\n        systolic_bp INT,\n        diastolic_bp INT,\n        temperature DECIMAL(5, 2),\n        status VARCHAR(50),\n        encrypted_data TEXT,\n        recorded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE\n      )\n    `\n\n    await sql`\n      CREATE TABLE IF NOT EXISTS alerts (\n        id SERIAL PRIMARY KEY,\n        patient_id VARCHAR(50) NOT NULL,\n        alert_type VARCHAR(50),\n        alert_level VARCHAR(50),\n        message TEXT,\n        is_acknowledged BOOLEAN DEFAULT FALSE,\n        acknowledged_by VARCHAR(255),\n        acknowledged_at TIMESTAMP,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE\n      )\n    `\n\n    await sql`\n      CREATE TABLE IF NOT EXISTS vital_history (\n        id SERIAL PRIMARY KEY,\n        patient_id VARCHAR(50) NOT NULL,\n        heart_rate_avg INT,\n        spo2_avg DECIMAL(5, 2),\n        systolic_bp_avg INT,\n        diastolic_bp_avg INT,\n        temperature_avg DECIMAL(5, 2),\n        status VARCHAR(50),\n        date_recorded DATE,\n        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE\n      )\n    `\n\n    // Create indexes\n    await sql`CREATE INDEX IF NOT EXISTS idx_patient_id ON vitals(patient_id)`\n    await sql`CREATE INDEX IF NOT EXISTS idx_ambulance_id ON vitals(ambulance_id)`\n    await sql`CREATE INDEX IF NOT EXISTS idx_recorded_at ON vitals(recorded_at)`\n    await sql`CREATE INDEX IF NOT EXISTS idx_alert_patient_id ON alerts(patient_id)`\n    await sql`CREATE INDEX IF NOT EXISTS idx_alert_created_at ON alerts(created_at)`\n\n    // Seed data\n    await sql`\n      INSERT INTO patients (patient_id, name, age, gender, medical_conditions) \n      VALUES \n        ('PAT001', 'John Doe', 45, 'M', 'Hypertension'),\n        ('PAT002', 'Jane Smith', 52, 'F', 'Diabetes, Heart Disease'),\n        ('PAT003', 'Michael Johnson', 38, 'M', 'Asthma')\n      ON CONFLICT (patient_id) DO NOTHING\n    `\n\n    await sql`\n      INSERT INTO ambulances (ambulance_id, driver_name, status) \n      VALUES \n        ('AMB001', 'Officer Mike', 'available'),\n        ('AMB002', 'Officer Sarah', 'available')\n      ON CONFLICT (ambulance_id) DO NOTHING\n    `\n\n    return NextResponse.json({\n      success: true,\n      message: \"Database initialized successfully\",\n      tables: [\"patients\", \"ambulances\", \"vitals\", \"alerts\", \"vital_history\"],\n    })\n  } catch (error) {\n    console.error(\"[v0] Database init error:\", error)\n    return NextResponse.json({ error: \"Failed to initialize database\", details: String(error) }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,QAAQ,GAAG,CAAC,iBAAiB,IAAI,QAAQ,GAAG,CAAC,sBAAsB;QACvF,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,MAAM,MAAM,IAAA,gKAAI,EAAC;QAEjB,MAAM,GAAG,CAAC;;;;;;;;;;;;IAYV,CAAC;QAED,MAAM,GAAG,CAAC;;;;;;;;;;IAUV,CAAC;QAED,MAAM,GAAG,CAAC;;;;;;;;;;;;;;;;IAgBV,CAAC;QAED,MAAM,GAAG,CAAC;;;;;;;;;;;;;IAaV,CAAC;QAED,MAAM,GAAG,CAAC;;;;;;;;;;;;;;IAcV,CAAC;QAED,iBAAiB;QACjB,MAAM,GAAG,CAAC,+DAA+D,CAAC;QAC1E,MAAM,GAAG,CAAC,mEAAmE,CAAC;QAC9E,MAAM,GAAG,CAAC,iEAAiE,CAAC;QAC5E,MAAM,GAAG,CAAC,qEAAqE,CAAC;QAChF,MAAM,GAAG,CAAC,qEAAqE,CAAC;QAEhF,YAAY;QACZ,MAAM,GAAG,CAAC;;;;;;;IAOV,CAAC;QAED,MAAM,GAAG,CAAC;;;;;;IAMV,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,QAAQ;gBAAC;gBAAY;gBAAc;gBAAU;gBAAU;aAAgB;QACzE;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAiC,SAAS,OAAO;QAAO,GAAG;YAAE,QAAQ;QAAI;IAC7G;AACF","debugId":null}}]
}